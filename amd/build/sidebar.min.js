define("format_pathway/sidebar",["core/ajax","core/log"],(function(ajax,log){var elements={},collapsed=!1;var SELECTORS={WRAPPER:"#pathway-wrapper",SIDEBAR:"#pathway-sidebar",TOGGLE_BTN:"#pathway-sidebar-toggle",EXPAND_BTN:"#pathway-expand-btn"};var CSS={COLLAPSED:"pathway-sidebar-collapsed"};var collapseSidebar=function(){collapsed=!0;elements.wrapper.classList.add(CSS.COLLAPSED);elements.sidebar.setAttribute("aria-hidden","true");elements.expandBtn.style.display="";elements.expandBtn.focus();saveSidebarPreference(!0)};var expandSidebar=function(){collapsed=!1;elements.wrapper.classList.remove(CSS.COLLAPSED);elements.sidebar.setAttribute("aria-hidden","false");elements.expandBtn.style.display="none";elements.toggleBtn.focus();saveSidebarPreference(!1)};var saveSidebarPreference=function(isCollapsed){try{ajax.call([{methodname:"core_user_update_user_preferences",args:{preferences:[{type:"format_pathway_sidebar_collapsed",value:isCollapsed?"1":"0"}]}}])}catch(err){log.warn("format_pathway/sidebar: Could not save preference.",err)}};var registerEventListeners=function(){elements.toggleBtn.addEventListener("click",(function(e){e.preventDefault();collapseSidebar()}));elements.expandBtn.addEventListener("click",(function(e){e.preventDefault();expandSidebar()}));elements.toggleBtn.addEventListener("keydown",(function(e){if(e.key==="Enter"||e.key===" "){e.preventDefault();collapseSidebar()}}));elements.expandBtn.addEventListener("keydown",(function(e){if(e.key==="Enter"||e.key===" "){e.preventDefault();expandSidebar()}}))};var MOBILE_BREAKPOINT=768;return{init:function(initiallyCollapsed){var wrapper=document.querySelector(SELECTORS.WRAPPER);var sidebar=document.querySelector(SELECTORS.SIDEBAR);var toggleBtn=document.querySelector(SELECTORS.TOGGLE_BTN);var expandBtn=document.querySelector(SELECTORS.EXPAND_BTN);if(!wrapper||!sidebar||!toggleBtn||!expandBtn){log.debug("format_pathway/sidebar: Required DOM elements not found. Sidebar JS not initialised.");return}elements={wrapper:wrapper,sidebar:sidebar,toggleBtn:toggleBtn,expandBtn:expandBtn};registerEventListeners();var isMobile=window.innerWidth<MOBILE_BREAKPOINT;if(initiallyCollapsed||isMobile){collapseSidebar()}var resizeTimer;window.addEventListener("resize",(function(){clearTimeout(resizeTimer);resizeTimer=setTimeout((function(){var nowMobile=window.innerWidth<MOBILE_BREAKPOINT;if(nowMobile&&!collapsed){collapseSidebar()}}),250)}))}}}));
